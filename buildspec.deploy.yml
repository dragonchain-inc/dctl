version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 10
    commands:
      - wget https://github.com/stedolan/jq/releases/download/jq-1.5/jq-1.5.tar.gz && tar xzf jq-1.5.tar.gz && cd jq-1.5 && ./configure && make && make install && cd .. && rm -rf jq-1.5.tar.gz jq-1.5
  build:
    commands:
      - VERSION=$(node -e "console.log(require('./package.json').version)")
      - npm config set '//registry.npmjs.org/:_authToken' $(aws ssm get-parameter --name npm-publish-token --with-decryption | jq '.Parameter.Value')
      - npm publish --access public